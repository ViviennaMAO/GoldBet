<!-- pages/index/index.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨é’±åŒ…çŠ¶æ€ -->
  <view class="wallet-status card">
    <view wx:if="{{isLoggedIn}}" class="wallet-connected">
      <view class="wallet-icon">ğŸ”—</view>
      <view class="wallet-info">
        <text class="wallet-label">å·²è¿æ¥é’±åŒ…</text>
        <text class="wallet-address">{{walletAddress}}</text>
      </view>
      <button class="btn-logout" bindtap="handleLogout" size="mini">é€€å‡º</button>
    </view>
    <view wx:else class="wallet-disconnected">
      <view class="wallet-icon">ğŸ”“</view>
      <view class="wallet-info">
        <text class="wallet-label">æœªè¿æ¥é’±åŒ…</text>
        <text class="wallet-hint">è¿æ¥é’±åŒ…ä»¥å¼€å§‹é¢„æµ‹</text>
      </view>
      <button class="btn-primary" bindtap="handleLogin">è¿æ¥é’±åŒ…</button>
    </view>
  </view>

  <!-- å½“å‰é‡‘ä»·å¡ç‰‡ -->
  <view class="price-card card">
    <view class="price-header">
      <text class="price-title">å½“å‰é‡‘ä»·</text>
      <view class="price-refresh" bindtap="refreshPrice">
        <text class="refresh-icon {{isRefreshing ? 'rotating' : ''}}">âŸ³</text>
        <text class="refresh-text">åˆ·æ–°</text>
      </view>
    </view>

    <view wx:if="{{priceData}}" class="price-content">
      <view class="current-price">
        <text class="price">{{priceData.currentPrice}}</text>
        <text class="price-unit">USD/ç›å¸</text>
      </view>

      <view class="price-change {{priceData.changePercent >= 0 ? 'positive' : 'negative'}}">
        <text>{{priceData.changeText}}</text>
      </view>

      <view class="price-details">
        <view class="detail-item">
          <text class="detail-label">æ˜¨æ—¥æ”¶ç›˜</text>
          <text class="detail-value">{{priceData.previousClose}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ›´æ–°æ—¶é—´</text>
          <text class="detail-value">{{priceData.updateTime}}</text>
        </view>
      </view>
    </view>

    <view wx:else class="price-loading">
      <view class="loading">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </view>
  </view>

  <!-- æ¨¡å¼åˆ‡æ¢å™¨ -->
  <view class="mode-selector">
    <view 
      class="mode-item {{bettingMode === 'direction' ? 'active' : ''}}" 
      bindtap="switchMode" 
      data-mode="direction"
    >Directional</view>
    <view 
      class="mode-item {{bettingMode === 'volatility' ? 'active' : ''}}" 
      bindtap="switchMode" 
      data-mode="volatility"
    >Volatility</view>
  </view>

  <!-- 1. çŒœæ¶¨è·Œé¢æ¿ -->
  <view class="bet-widget card" wx:if="{{bettingMode === 'direction'}}">
    <view class="bet-tabs">
      <view class="tab-item active">Buy</view>
    </view>

    <view class="direction-select">
      <view 
        class="dir-btn up {{betDirection === 'up' ? 'active' : ''}}" 
        bindtap="selectDirection" 
        data-direction="up"
      >
        <text class="dir-icon">ğŸ“ˆ</text>
        <text>Up $0.74</text>
      </view>
      <view 
        class="dir-btn down {{betDirection === 'down' ? 'active' : ''}}" 
        bindtap="selectDirection" 
        data-direction="down"
      >
        <text class="dir-icon">ğŸ“‰</text>
        <text>Down $0.27</text>
      </view>
    </view>

    <view class="amount-section">
      <view class="amount-header">
        <text class="amount-title">Amount</text>
        <text class="balance-text">Balance ${{balance}}</text>
      </view>
      <view class="amount-input-wrapper">
        <text class="currency-symbol">$</text>
        <input 
          class="amount-input" 
          type="digit" 
          placeholder="0.00" 
          value="{{betAmount}}" 
          bindinput="onAmountInput"
        />
      </view>
    </view>

    <view class="quick-amounts">
      <view class="quick-btn" bindtap="addAmount" data-value="{{1}}">+$1</view>
      <view class="quick-btn" bindtap="addAmount" data-value="{{20}}">+$20</view>
      <view class="quick-btn" bindtap="addAmount" data-value="{{100}}">+$100</view>
      <view class="quick-btn" bindtap="setMaxAmount">Max</view>
    </view>

    <button 
      class="btn-trade {{betDirection === 'up' ? 'up' : 'down'}}" 
      bindtap="submitBet" 
      loading="{{isSubmitting}}"
    >
      {{betDirection === 'up' ? 'Buy Up' : 'Buy Down'}}
    </button>

    <view class="terms-text">
      Settles tomorrow at 16:00 UTC. No modifications after purchase.
    </view>
  </view>

  <!-- 2. çŒœæ³¢åŠ¨ç‡é¢æ¿ -->
  <view class="bet-widget card" wx:if="{{bettingMode === 'volatility'}}">
    <view class="bet-tabs">
      <view class="tab-item active">Buy Volatility</view>
    </view>

    <view class="vol-section">
      <view class="section-title">Select Range</view>
      <view class="vol-list">
        <view 
          class="vol-item {{betVolatility === 'small' ? 'active' : ''}}" 
          bindtap="selectVolatility" 
          data-volatility="small"
        >
          <view class="vol-info">
            <text class="vol-label">Low Volatility</text>
            <text class="vol-range">{{volatilityRanges.small}}</text>
          </view>
          <view class="vol-dot small"></view>
        </view>
        <view 
          class="vol-item {{betVolatility === 'medium' ? 'active' : ''}}" 
          bindtap="selectVolatility" 
          data-volatility="medium"
        >
          <view class="vol-info">
            <text class="vol-label">Mid Volatility</text>
            <text class="vol-range">{{volatilityRanges.medium}}</text>
          </view>
          <view class="vol-dot medium"></view>
        </view>
        <view 
          class="vol-item {{betVolatility === 'large' ? 'active' : ''}}" 
          bindtap="selectVolatility" 
          data-volatility="large"
        >
          <view class="vol-info">
            <text class="vol-label">High Volatility</text>
            <text class="vol-range">{{volatilityRanges.large}}</text>
          </view>
          <view class="vol-dot large"></view>
        </view>
      </view>
    </view>

    <view class="amount-section">
      <view class="amount-header">
        <text class="amount-title">Investment</text>
        <text class="balance-text">Balance ${{balance}}</text>
      </view>
      <view class="amount-input-wrapper">
        <text class="currency-symbol">$</text>
        <input 
          class="amount-input" 
          type="digit" 
          placeholder="0.00" 
          value="{{betAmount}}" 
          bindinput="onAmountInput"
        />
      </view>
    </view>

    <button 
      class="btn-trade vol" 
      bindtap="submitBet" 
      loading="{{isSubmitting}}"
    >
      Invest in Volatility
    </button>

    <view class="terms-text">
      Volatility = |High - Low| / Open * 100%. Rewards based on accuracy.
    </view>
  </view>
</view>
